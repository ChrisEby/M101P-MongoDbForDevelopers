b'\nimport pymongo\nimport urllib2\nimport urllib\nimport cookielib\nimport random\nimport re\nimport string\nimport sys\nimport getopt\n\n# this is a validation program to make sure that the blog works correctly.\n# If you are reading this in clear text, you are probably violating the honor code\n\n\n# declare the variables to connect to db\nconnection = None\ndb = None\n\nwebhost = "localhost:8082"\nmongostr = "mongodb://localhost:27017"\ndb_name = "blog"\n\n\n# makes a little salt\ndef make_salt(n):\n    salt = ""\n    for i in range(n):\n        salt = salt + random.choice(string.ascii_letters)\n    return salt\n\n\ndef create_user(username, password):\n    try:\n        print "Trying to create a test user ", username\n        cj = cookielib.CookieJar()\n        url = "http://{0}/signup".format(webhost)\n\n        data = urllib.urlencode([("email",""),("username",username), ("password",password), ("verify",password)])\n        request = urllib2.Request(url=url, data=data)\n        opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))\n        f = opener.open(request)\n\n        users = db.users\n        user = users.find_one({\'_id\':username})\n        if (user == None):\n            print "Could not find the test user ", username, "in the users collection."\n            return False\n        print "Found the test user ", username, " in the users collection"\n\n        # check that the user has been built\n        result = f.read()\n        expr = re.compile("Welcome\\s+"+ username)\n        if expr.search(result):\n            return True\n        \n        print "When we tried to create a user, here is the output we got\\n"\n        print result\n        \n        return False\n    except:\n        print "the request to ", url, " failed, so your blog may not be running."\n        return False\n\n\ndef try_to_login(username, password):\n\n    try:\n        print "Trying to login for test user ", username\n        cj = cookielib.CookieJar()\n        url = "http://{0}/login".format(webhost)\n\n        data = urllib.urlencode([("username",username), ("password",password)])\n        request = urllib2.Request(url=url, data=data)\n        opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))\n        f = opener.open(request)\n\n        # check for successful login\n        result = f.read()\n        expr = re.compile("Welcome\\s+"+ username)\n        if expr.search(result):\n            return True\n\n        print "When we tried to login, here is the output we got\\n"\n        print result\n        return False\n    except:\n        print "the request to ", url, " failed, so your blog may not be running."\n        raise\n        return False\n\n\n# command line arg parsing to make folks happy who want to run at mongolabs or mongohq\n# this functions uses global vars to communicate. forgive me.\ndef arg_parsing(argv):\n\n    global webhost\n    global mongostr\n    global db_name\n\n    try:\n        opts, args = getopt.getopt(argv, "-p:-m:-d:")\n    except getopt.GetoptError:\n        print "usage validate.py -p webhost -m mongoConnectString -d databaseName"\n        print "\\twebhost defaults to {0}".format(webhost)\n        print "\\tmongoConnectionString default to {0}".format(mongostr)\n        print "\\tdatabaseName defaults to {0}".format(db_name)\n        sys.exit(2)\n    for opt, arg in opts:\n        if (opt == \'-h\'):\n            print "usage validate.py -p webhost -m mongoConnectString -d databaseName"\n            sys.exit(2)\n        elif opt in ("-p"):\n            webhost = arg\n            print "Overriding HTTP host to be ", webhost\n        elif opt in ("-m"):\n            mongostr = arg\n            print "Overriding MongoDB connection string to be ", mongostr\n        elif opt in ("-d"):\n            db_name = arg\n            print "Overriding MongoDB database to be ", db_name\n\n\n# main section of the code\ndef main(argv):\n            \n    arg_parsing(argv)\n    global connection\n    global db\n\n    print "Welcome to the HW 2.3 validation tester"\n\n    # connect to the db (mongostr was set in arg_parsing)\n    connection = pymongo.MongoClient(mongostr)\n    db = connection[db_name]\n            \n\n    username = make_salt(7)\n    password = make_salt(8)\n\n    # try to create user\n\n    if (create_user(username, password)):\n        print "User creation successful. "\n        # try to login\n        if (try_to_login(username, password)):\n            print "User login successful."\n            print "Validation Code is ", "jkfds9834j98fnm39njf0920fn2"\n        else:\n            print "User login failed"\n            print "Sorry, you have not solved it yet."\n\n    else:\n        print "Sorry, you have not solved it yet."\n        sys.exit(1)\n\n\nif __name__ == "__main__":\n    main(sys.argv[1:])\n\n\n\n\n\n\n\n'
